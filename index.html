<html>
    <head>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
      
        <style>
          body {
            margin: 0;
          }
        </style>
      
        <script src="https://unpkg.com/d3-array"></script>
        <script src="https://unpkg.com/d3-scale"></script>
      
        <script src="https://unpkg.com/globe.gl"></script>
        <!-- <script src="../../dist/globe.gl.js"></script> -->

        <link rel="stylesheet" href="style.css">
        
    </head>
      
      <body>

        <div id"mlabel" style="position: absolute;" class="mainLabel">
          <h2 id="toplabel" class="labelStyle" style="font-size: 30px; color: white;">1971, 17 Apr</h2>
        </div>
        
        <div id="menu" style="position:absolute; z-index:30; width:400px; height:50px; background-color: rgba(0, 0, 0, 0.7);">
          <div style="display:flex; justify-content: space-around; align-items: center; height: 100%; text-align: center">
            <h2 id="con" style="box-sizing: border-box; border-bottom: 2px solid white; font-size: 24px; color: white; cursor: pointer;">Continuous</h2>
            <h2 id="nak" style="box-sizing: border-box; font-size: 24px; color: white; cursor: pointer;">Nakamura</h2>
          </div>
        </div>

        <div id="contdata" style="position:absolute; z-index:20; top:55px; width:400px; background-color: rgba(0, 0, 0, 0.7); ">
          <h1 style="font-size: 30px; font-weight: bold; color: white; text-align: center; margin: 8px 0 8px 0;">Moonquake Map</h1>
          <div class="" style="text-align: center;">
            <h3 style="font-size: 20px; color:white; font-weight: bold;">Year</h3>
            <input id="yearslider" min="0" max="8" type="range" class="form-range" style="width: 80%;">
            <div style="margin-top: 5px;">
              <label id="yearlabel" for="customRange1" class="form-label" style="display: inline-block; padding: 0 8px 0 8px; text-align:center; font-size: 25px; border-radius: 5px; padding: 0px 8px 0 8px;; background-color: rgba(255, 255, 255, 0.6);">1969</label>
            </div>

            <h3 style="font-size: 20px; color:white; font-weight: bold;">Month</h3>
            <input id="monthslider" min="0" max="11" type="range" class="form-range" style="width: 80%;">
            <div style="margin-top: 5px;">
              <label id="monthlabel" for="customRange1" class="form-label" style="display: inline-block; padding: 0 8px 0 8px; text-align:center; font-size: 25px; border-radius: 5px; padding: 0px 8px 0 8px;; background-color: rgba(255, 255, 255, 0.6);">Jan</label>
            </div>

            <h3 style="font-size: 20px; color:white; font-weight: bold;">Day</h3>
            <input id="dayslider" min="1" max="30" type="range" class="form-range" style="width: 80%;">
            <div style="margin-top: 5px;">
              <label id="daylabel" for="customRange1" class="form-label" style="display: inline-block; padding: 0 8px 0 8px; text-align:center; font-size: 25px; border-radius: 5px; padding: 0px 8px 0 8px;; background-color: rgba(255, 255, 255, 0.6);">1</label>
            </div>

            <button id="getData" style="margin-top: 10px; border: 1px solid white; background-color:black; color:white; border-radius: 5px; font-size: 20px; text-align:center; padding: 4px 8px 4px 8px; ">Show Data</button>

          </div>
        </div>

        <div id="nakamura" style="display:none;position:absolute; top:55px; z-index:20; width:400px; background-color: rgba(0, 0, 0, 0.7); text-align:center;">
          <h1 style="font-size: 30px; font-weight: bold; color: white; text-align: center; margin: 8px 0 8px 0;">Nakamura Seismic Events</h1>
          <div id="naklabels" style="text-align: center; margin-top: 10px; height: 70vh; overflow: scroll;">
            <div nakNum="0" style="margin: 20px 0px;">
              <h3 class="nakEvent">1971, 17 April</h3>
            </div>

            <div nakNum="1" style="margin: 20px 0px;">
              <h3 class="nakEvent">1971, 20 May</h3>
            </div>

            <div nakNum="2" style="margin: 20px 0px;">
              <h3 class="nakEvent">1971, 11 July</h3>
            </div>

            <div nakNum="3" style="margin: 20px 0px;">
              <h3 class="nakEvent">1972, 2 January</h3>
            </div>

            <div nakNum="4" style="margin: 20px 0px;">
              <h3 class="nakEvent">1972, 17 September</h3>
            </div>

            <div nakNum="5" style="margin: 20px 0px;">
              <h3 class="nakEvent">1972, 06 December</h3>
            </div>

            <div nakNum="6" style="margin: 20px 0px;">
              <h3 class="nakEvent">1972, 09 December</h3>
            </div>

            <div nakNum="7" style="margin: 20px 0px;">
              <h3 class="nakEvent">1973, 08 February</h3>
            </div>

            <div nakNum="8" style="margin: 20px 0px;">
              <h3 class="nakEvent">1973, 13 March</h3>
            </div>

            <div nakNum="9" style="margin: 20px 0px;">
              <h3 class="nakEvent">1973, 20 June</h3>
            </div>

            <div nakNum="10" style="margin: 20px 0px;">
              <h3 class="nakEvent">1973, 01 October</h3>
            </div>

            <div nakNum="11" style="margin: 20px 0px;">
              <h3 class="nakEvent">1974, 23 February</h3>
            </div>

            <div nakNum="12" style="margin: 20px 0px;">
              <h3 class="nakEvent">1974, 27 March</h3>
            </div>

            <div nakNum="13" style="margin: 20px 0px;">
              <h3 class="nakEvent">1974, 19 April</h3>
            </div>

            <div nakNum="14" style="margin: 20px 0px;">
              <h3 class="nakEvent">1974, 29 May</h3>
            </div>

            <div nakNum="15" style="margin: 20px 0px;">
              <h3 class="nakEvent">1974, 11 July</h3>
            </div>

            <div nakNum="16" style="margin: 20px 0px;">
              <h3 class="nakEvent">1975, 03 January</h3>
            </div>

            <div nakNum="17" style="margin: 20px 0px;">
              <h3 class="nakEvent">1975, 12 January</h3>
            </div>

            <div nakNum="18" style="margin: 20px 0px;">
              <h3 class="nakEvent">1975, 13 January</h3>
            </div>

            <div nakNum="19" style="margin: 20px 0px;">
              <h3 class="nakEvent">1975, 13 February</h3>
            </div>

            <div nakNum="20" style="margin: 20px 0px;">
              <h3 class="nakEvent">1975, 07 May</h3>
            </div>

            <div nakNum="21" style="margin: 20px 0px;">
              <h3 class="nakEvent">1975, 27 May</h3>
            </div>

            <div nakNum="22" style="margin: 20px 0px;">
              <h3 class="nakEvent">1975, 10 November</h3>
            </div>

            <div nakNum="23" style="margin: 20px 0px;">
              <h3 class="nakEvent">1976, 04 January</h3>
            </div>

            <div nakNum="24" style="margin: 20px 0px;">
              <h3 class="nakEvent">1976, 12 January</h3>
            </div>

            <div nakNum="25" style="margin: 20px 0px;">
              <h3 class="nakEvent">1976, 06 March</h3>
            </div>

            <div nakNum="26" style="margin: 20px 0px;">
              <h3 class="nakEvent">1976, 08 March</h3>
            </div>

            <div nakNum="27" style="margin: 20px 0px;">
              <h3 class="nakEvent">1976, 16 May</h3>
            </div>
            
           
          </div>
          <button id="clearMap">Clear Map</button>
        </div>

        <div id="cont" style="display: none;position:absolute; right: 5px; top:5px; z-index:20; background-color: rgba(200, 255, 255, 0.6)">
          <div style="position: absolute; right:5px; cursor: pointer;" onclick="document.getElementById('cont').style.display = 'none';">
            <svg width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.72 5.72a.75.75 0 011.06 0L12 10.94l5.22-5.22a.75.75 0 111.06 1.06L13.06 12l5.22 5.22a.75.75 0 11-1.06 1.06L12 13.06l-5.22 5.22a.75.75 0 01-1.06-1.06L10.94 12 5.72 6.78a.75.75 0 010-1.06z"/></svg>
          </div>
          <img id="plots" src="" alt="">
        </div>
   

        <script>

          let marker = `<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
<path style="fill:#FF9900;" d="M507.494,426.066L282.864,53.536c-5.677-9.415-15.87-15.172-26.865-15.172
	c-10.994,0-21.188,5.756-26.865,15.172L4.506,426.066c-5.842,9.689-6.015,21.774-0.451,31.625
	c5.564,9.852,16.001,15.944,27.315,15.944h449.259c11.314,0,21.751-6.093,27.315-15.944
	C513.509,447.839,513.336,435.755,507.494,426.066z"/>
<path style="fill:#FFDC35;" d="M255.999,38.365c-10.994,0-21.188,5.756-26.865,15.172L4.506,426.066
	c-5.842,9.689-6.015,21.774-0.451,31.625c5.564,9.852,16.001,15.944,27.315,15.944h224.629L255.999,38.365L255.999,38.365z"/>
<path style="fill:#F20013;" d="M445.326,432.791H67.108c-3.591,0-6.911-1.909-8.718-5.012c-1.807-3.104-1.827-6.934-0.055-10.056
	L247.23,85.028c1.792-3.155,5.139-5.106,8.767-5.107c0.001,0,0.003,0,0.004,0c3.626,0,6.974,1.946,8.767,5.099l189.324,332.694
	c1.777,3.123,1.759,6.955-0.047,10.061S448.918,432.791,445.326,432.791z M84.436,412.616h343.543L256.013,110.423L84.436,412.616z"
	/>
<path style="fill:#FF4B00;" d="M256.332,412.616H84.436l171.576-302.192l-0.01-30.501h-0.005c-3.628,0.001-6.976,1.951-8.767,5.107
	L58.336,417.722c-1.773,3.123-1.752,6.953,0.055,10.056c1.807,3.104,5.127,5.012,8.718,5.012h189.224v-20.175H256.332z"/>
<path style="fill:#533F29;" d="M279.364,376.883c0,12.344-10.537,23.182-22.88,23.182c-13.246,0-23.182-10.838-23.182-23.182
	c0-12.644,9.935-23.182,23.182-23.182C268.826,353.701,279.364,364.238,279.364,376.883z M273.644,319.681
	c0,9.333-10.236,13.246-17.462,13.246c-9.634,0-17.762-3.914-17.762-13.246c0-35.826-4.214-87.308-4.214-123.134
	c0-11.741,9.634-18.365,21.977-18.365c11.741,0,21.677,6.623,21.677,18.365C277.858,232.373,273.644,283.855,273.644,319.681z"/>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>`;

         
          
          
          let labelMark = `<div onmouseout="this.children[1].style.display = 'none';" onmouseover="this.children[1].style.display = 'block';"><div class="dangerIcon" style="width: 15px;">${marker}</div><div class="seismicdata" style="display: none;width:90px; position:absolute; top: 10px; left:6px; background-color: rgba(0, 0, 0, 0.6); border: 1px solid white;"><h4 style="font-size: 11px; color: white;">Lat: {lat}<br>Long: {long}<br>Magnitude: {magn}<br>{string}</h4></div></div>`;

          let years = ['1969', '1970', '1971', '1972', '1973', '1974', '1975', '1976', '1977'];
          
          let months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

          document.getElementById('yearslider').addEventListener('input', (event) => {

            document.getElementById('yearlabel').innerText = years[event.target.value];

            let curYear = parseInt(event.target.value) + 1969;

            
            let currMonth = parseInt(document.getElementById('monthslider').value);

            let date = new Date(curYear, currMonth+1, 0);

            let dayslider = document.getElementById('dayslider');

            dayslider.setAttribute('max', date.getDate());
            dayslider.value = 1;
            document.getElementById('daylabel').innerText = 1;
            

      
          });

          document.getElementById('monthslider').addEventListener('input', (event) => {


            document.getElementById('monthlabel').innerText = months[event.target.value];

            let curYear = parseInt(document.getElementById('yearslider').value) + 1969;
            
            let currMonth = parseInt(document.getElementById('monthslider').value);

            let date = new Date(curYear, currMonth+1, 0);

            let dayslider = document.getElementById('dayslider');

            dayslider.setAttribute('max', date.getDate());
            dayslider.value = 1;
            document.getElementById('daylabel').innerText = 1;
            
          
      
          });

          document.getElementById('dayslider').addEventListener('input', (event) => {
            document.getElementById('daylabel').innerText = event.target.value;
            
      
          });

          


        </script>
      
        <div id="globeViz"></div>
      
        <script>
          const colorScale = d3.scaleOrdinal(['orangered', 'mediumblue', 'darkgreen', 'yellow']);
      
          const labelsTopOrientation = new Set(['Apollo 12', 'Luna 2', 'Luna 20', 'Luna 21', 'Luna 24', 'LCROSS Probe']); // avoid label collisions
      
      
          const elem = document.getElementById('globeViz');
      
      
          const N = 10;

          let gData = [];

          let markdata = [];

          let apolloSeismic;


          let nakaData;


          async function getData() {

            let naka = await fetch('./cleanedData.json');

            nakaData = await naka.json();

            let apollo = await fetch('./Apollo_seismic_network.json');

            apolloSeismic = await apollo.json();

            

            // for (let index = 0; index < 5; index++) {

            //   gData.push({
            //     lat: nakaData[index].lat,
            //     lng: nakaData[index].long,
            //     maxR: nakaData[index].magn * 7,
            //     propagationSpeed: 5,
            //     repeatPeriod: 500
            //   });

            //   markdata.push({
            //     nak: true,
            //     lat: apolloSeismic[index].lat,
            //     lng: apolloSeismic[index].long,
            //     size: nakaData[index].magn * 10,
            //     year: nakaData[index].year,
            //     day: nakaData[index].day,
            //     month: nakaData[index].month,
            //     mgn: nakaData[index].magn,
            //   });


            // }

            for (let index = 0; index < apolloSeismic.length; index++) {
              

              markdata.push({
                nak: false,
                lat: apolloSeismic[index].lat,
                lng: apolloSeismic[index].lng,
                mission: apolloSeismic[index].mission,
                name: apolloSeismic[index].name
              });

            }

            start();

          }

          

          function start() {
            
      
            
            const moon = Globe()
              .globeImageUrl('./lunar_surface.jpg')
              .bumpImageUrl('./lunar_bumpmap.jpg')
              .backgroundImageUrl('https://unpkg.com/three-globe@2.24.7/example/img/night-sky.png')
              .showGraticules(false)
              .showAtmosphere(false) // moon has no atmosphere
              // .labelText('label')
              // .labelSize(1.7)
              // .labelDotRadius(0.4)
              // .labelDotOrientation(d => labelsTopOrientation.has(d.label) ? 'top' : 'bottom')
        //       .labelColor(d => colorScale(d.agency))
        //       .labelLabel(d => `
        //           <div style="background-color: lightgray;"
        // ><b>${d.label}</b></div>
        //           <div>${d.agency} - ${d.program} Program</div>
        //           <div>Landing on <i>${new Date(d.date).toLocaleDateString()}</i></div>
        //         `)
        //       .onLabelClick(d => window.open(d.url, '_blank'))
              .ringsData(gData)
              .ringColor(() => colorInterpolator)
              .ringMaxRadius('maxR')
              .ringPropagationSpeed('propagationSpeed')
              .ringRepeatPeriod('repeatPeriod')
              .htmlElementsData(markdata)
              .htmlElement(d => {
                const el = document.createElement('div');

                if (d.nak) {
                  el.innerHTML = labelMark.replace('{string}', new Date(d.year, d.month, d.day).toDateString()).replace('{lat}', d.lat)
                  .replace('{long}', d.lng)
                  .replace('{magn}', d.mgn);
                } else {

                  let apolloMarks = `<div onmouseout="this.children[1].style.display = 'none';" onmouseover="this.children[1].style.display = 'block';"><div class="dangerIcon" style="width: 15px;">${marker}</div><div class="seismicdata" style="display: none;width:90px; position:absolute; top: 10px; left:6px; background-color: rgba(0, 0, 0, 0.6); border: 1px solid white;"><h4 style="font-size: 11px; color: white;">Mission: {miss}<br>Name: {na}<br>Lat: {lat}<br>Long: {long}</h4></div></div>`;

                  el.innerHTML = apolloMarks.replace('{lat}', d.lat)
                  .replace('{long}', d.lng)
                  .replace('{miss}', d.mission)
                  .replace('{na}', d.name);
                }
                

                // el.style.width = `${d.size}px`;
                
                el.style['pointer-events'] = 'auto';
                el.style.cursor = 'pointer';
                el.onclick = () => {

                  document.getElementById('plots').src = './chart.jpg';
                  document.getElementById('cont').style.display = "block";
                };
                return el;
              })
              (document.getElementById('globeViz'));
      
              
      
            const colorInterpolator = t => `rgba(255,100,50,${Math.sqrt(1 - t)})`;

            function clearTab(event) {
              document.getElementById('contdata').style.display = 'none';
              document.getElementById('nakamura').style.display = 'block';
              document.getElementById('con').style.borderBottom = 'none';
              document.getElementById('nak').style.borderBottom = '2px solid white';

              markdata = [];

              gData = [];
              
              moon.ringsData([]);
              moon.htmlElementsData([]);

            }

            document.getElementById('nak').addEventListener('click', clearTab);

            document.getElementById('clearMap').addEventListener('click', (event) => {

              markdata = [];

              gData = [];
              
              moon.ringsData([]);
              moon.htmlElementsData([]);

              let divs = document.querySelectorAll('.nakEvent');

              for (const child of divs) {
              child.style.backgroundColor = "rgba(0, 0, 0, 0.6)";
              
            }

            });

            

            document.getElementById('con').addEventListener('click', (event) => {
              document.getElementById('nakamura').style.display = 'none';
              document.getElementById('contdata').style.display = 'block';
              document.getElementById('nak').style.borderBottom = 'none';
              document.getElementById('con').style.borderBottom = '2px solid white';

              markdata = [];


              for (let index = 0; index < apolloSeismic.length; index++) {
              

                markdata.push({
                  nak: false,
                  lat: apolloSeismic[index].lat,
                  lng: apolloSeismic[index].lng,
                  mission: apolloSeismic[index].mission,
                  name: apolloSeismic[index].name
                });

              }

             moon.htmlElementsData(markdata);
        
            });


            function showNaka(event) {
              let index = event.currentTarget.getAttribute("nakNum");

              event.currentTarget.children[0].style.backgroundColor = 'rgba(192, 192, 192, 0.6)';


              document.getElementById('toplabel').innerText = event.currentTarget.children[0].innerText;


              
                markdata.push({
                  nak: true,
                  lat: nakaData[index].lat,
                  lng: nakaData[index].long,
                  size: nakaData[index].magn * 10,
                  year: nakaData[index].year,
                  day: nakaData[index].day,
                  month: nakaData[index].month,
                  mgn: nakaData[index].magn,
                });
              
              // markdata.push({
              //   lat: nakaData[index].lat,
              //   lng: nakaData[index].long,
              //   size: nakaData[index].magn * 10,
              //   year: nakaData[index].year,
              //   day: nakaData[index].day,
              //   month: nakaData[index].month,
              //   mgn: nakaData[index].magn
              // })

              // document.getElementById('mycust').innerText = markdata.length;

              gData.push({
                lat: nakaData[index].lat,
                lng: nakaData[index].long,
                maxR: nakaData[index].magn * 7,
                propagationSpeed: 5,
                repeatPeriod: 500
              })

              moon.htmlElementsData(markdata);
              moon.ringsData(gData);

            }

            let naks = document.getElementById('naklabels');
            

            for (const child of naks.children) {
              child.style.cursor = "pointer";
              child.addEventListener('click', showNaka);
            }
      
          }

          
          getData();
          
      
          
        </script>
      </body>
</html>
